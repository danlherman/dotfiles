#!bin/bash
# Aliases

alias ll='ls -lh'
alias be='bundle exec'
alias vi='vim'
alias ~='cd ~'
alias genssh='~/.ssh/gen_ssh_config'
alias tmux="TERM=screen-256color-bce tmux"

# Links to common directories
alias c='cd ~/gdr/projects/'
alias mpl='cd ~/gdr/projects/mpl'
alias mplimport='cd ~/gdr/projects/mpl_import'
alias mplstub='cd ~/gdr/projects/mpl_stub'
alias mplscripts='cd ~/gdr/projects/mpl_scripts'
alias mplsim='cd ~/gdr/projects/mpl_sim'
alias sub='cd ~/gdr/projects/subscriber_portal'
alias dl='cd ~/gdr/projects/consumer_portal'
alias doc='cd ~/gdr/projects/doc_control_client'
alias dots='cd ~/dotfiles'
alias cook='cd ~/gdr/projects/cookbook-opsworks' 
alias filei='cd ~/gdr/projects/fileimport'
alias sd='cd ~/gdr/projects/sys_doc'

# Easy editing of aliases file
alias ea='vim ~/.bash/bash_aliases'
alias sa='source ~/.bash/bash_aliases;echo "Aliases updated"'

# Easy editing of bash_profile
alias eb='vim ~/.bash_profile'
alias sb='source ~/.bash_profile; echo "Bash profile sourced"'

# Git shortcuts
alias gc='git commit'
alias gcn='git commit --no-verify'
alias gpull='git pull'
alias gpush='git push'
alias gpushn='git push --no-verify'
alias gco='git checkout'
alias gs='git status'
alias ga='git add .'
alias gd='git diff'
alias gm='git merge'
alias gpushall='gco staging;gm master;gpushn;gco production;gm staging;gpushn;gco master'

# Docker shortcuts
alias d='docker'
alias di='docker images'
alias dc='docker ps -a'
alias dfile='vi Dockerfile'
alias dbuild='docker build'
alias drm='docker rm'
alias drun='docker run --rm -it '

# Rails shortcuts
alias lastmigration='vim `last_rails_migration`'
alias rdbm='rake db:migrate;RAILS_ENV=test rake db:migrate'

# Dot files management
# Check(no changes) to dotfiles if see if there are any changes
alias dotc='for file in $(diff -qr ~/dotfiles ~/ | grep differ | cut -d " " -f 4); do echo "$file"; done'
# Update dotfiles from system to git repo if there are any changes
alias dotu='for file in $(diff -qr ~/dotfiles ~/ | grep differ | cut -d " " -f 4); do fp "$file"; echo "$file"; done'
# Checke(no changes) to Send updated dotfiles to system
alias dotpc='for file in $(diff -qr ~/ ~/dotfiles | grep differ | cut -d " " -f 4); do echo "$file"; done'
# Update dotfiles from git repo to system
alias dotp='for file in $(diff -qr ~/ ~/dotfiles | grep differ | cut -d " " -f 4); do fpp "$file"; echo "$file"; done'

complete -o default -o nospace -W "$(grep "^Host" $HOME/.ssh/config | grep -v "[?*]" | cut -d" " -f2)" scp sftp ssh

# Remote tailf command, specify servername to ssh to, and path starting from /var/log to/log/file
# example: remote_tail test-server1 squid/access.log
function remote_tail {
  ssh -t $1 "sudo tailf \"/var/log/$2\""
}

function patch_svr {
  ssh -t $1 "sudo yum update -y --skip-broken"
}

function fix_clam {
  ssh -t $1 "sudo chown clamav:clamav /var/lib/clamav -R && sudo freshclam"
}

function last_rails_migration {
  find ./db/migrate -type f | xargs ls -tr | tail -n 1
}

function fp {
  cp "$1" ~/dotfiles/"${1#*/*/*/}"
}

function fpp {
  cp -r "$1" ~/"${1#*/*/*/*/}"
}

